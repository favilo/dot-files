- name: Install podman repo
  template:
    src: "devel:kubic:libcontainers:stable.list.j2"
    dest: "/etc/apt/sources.list.d/devel:kubic:libcontainers:stable.list"
  become: true
  become_method: sudo
  when: ansible_distribution_version == "20.04"

- name: Fetch podman apt-key
  get_url:
   url: "https://download.opensuse.org/repositories/devel:kubic:libcontainers:stable/xUbuntu_{{ ansible_distribution_version }}/Release.key"
   dest: /tmp/podman.key
  when: ansible_distribution_version == "20.04"

- name: Install podman apt-key
  command: "apt-key add /tmp/podman.key"
  become: true
  become_method: sudo
  when: ansible_distribution_version == "20.04"

- name: Install apt packages
  apt:
    name:
    - qemu
    - qemu-system
    - nodejs
    - npm
    - sddm
    - flameshot
    - podman
    - autorandr
    - arandr
    - steam-installer
    state: present
    update_cache: true
  become_method: sudo
  become: true

- name: Install snap packages (classic confinement)
  snap:
    name:
    - slack
    - helm
    state: present
    classic: true
  become: true
  become_method: sudo

- name: add graphics-drivers ppa
  command: "add-apt-repository ppa:graphics-drivers/ppa"
  become: true
  become_method: sudo
  args:
    creates: "/etc/apt/sources.list.d/graphics-drivers-ubuntu-ppa-groovy.list"

- name: Install graphics drivers
  apt:
    name:
    - nvidia-driver-460
    - libnvidia-gl-460
    - libnvidia-gl-460:i386
    - libvulkan1
    - libvulkan1:i386
    update_cache: true
    state: present
  become: true
  become_method: sudo
